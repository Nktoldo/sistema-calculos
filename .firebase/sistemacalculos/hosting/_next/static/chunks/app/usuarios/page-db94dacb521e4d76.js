(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[634],{2206:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>c});var a=r(5155),o=r(2115),t=r(2619),l=r.n(t),n=r(63),i=r(5029),d=r(3714);function c(){let{user:e,loading:s,userRole:r,empresa:t}=(0,d.A)(),c=(0,n.useRouter)(),[u,m]=(0,o.useState)([]),[x,h]=(0,o.useState)(!1),[g,p]=(0,o.useState)(!1),[f,b]=(0,o.useState)(!1),[y,j]=(0,o.useState)(null),[v,N]=(0,o.useState)(""),[w,C]=(0,o.useState)(""),[k,E]=(0,o.useState)(""),[S,A]=(0,o.useState)("func"),[T,U]=(0,o.useState)(""),[_,F]=(0,o.useState)("func"),[P,z]=(0,o.useState)(""),[O,q]=(0,o.useState)(""),[D,R]=(0,o.useState)(!1);(0,o.useEffect)(()=>{s||e?s||"admin"===r||c.push("/"):c.push("/login")},[e,s,r,c]),(0,o.useEffect)(()=>{"admin"===r&&t&&V()},[r,t]);let V=async()=>{if(t){h(!0);try{let e=await (0,i.getAllUsuarios)(t);m(e)}catch(e){console.error("Erro ao carregar usu\xe1rios:",e),alert("Erro ao carregar usu\xe1rios")}finally{h(!1)}}},I=async()=>{if(!v||!w||!k||!t)return void alert("Por favor, preencha todos os campos");h(!0);try{await (0,i.j6)(v,w,k,S,t),alert("✅ Usu\xe1rio criado com sucesso!"),p(!1),N(""),C(""),E(""),A("func"),V()}catch(s){console.error("Erro ao criar usu\xe1rio:",s),console.error("Detalhes completos:",s);let e=s.message||"Erro desconhecido";e.includes("not-found")||e.includes("Fun\xe7\xe3o n\xe3o encontrada")?e="❌ Cloud Function n\xe3o encontrada. Por favor, verifique se as functions foram deployadas. Veja DEPLOY_INSTRUCTIONS.md para mais informa\xe7\xf5es.":e.includes("permission-denied")||e.includes("Acesso negado")?e="❌ Acesso negado. Apenas administradores podem criar usu\xe1rios.":e.includes("unauthenticated")||e.includes("n\xe3o autenticado")?e="❌ Voc\xea precisa estar logado para criar usu\xe1rios. Por favor, fa\xe7a login novamente.":e.includes("already-exists")||e.includes("j\xe1 est\xe1 cadastrado")?e="❌ Este email j\xe1 est\xe1 cadastrado no sistema.":(e.includes("internal")||e.includes("Erro interno"))&&(e="❌ Erro interno ao criar usu\xe1rio. Verifique:\n1. Se as Cloud Functions foram deployadas\n2. Se voc\xea tem permiss\xe3o de admin\n3. Os logs no Firebase Console\n\nDetalhes: "+e),alert(e)}finally{h(!1)}},G=async()=>{if(!y||!T)return void alert("Por favor, preencha o nome");h(!0);try{await (0,i.g5)(y.uid,T,_),alert("✅ Usu\xe1rio atualizado com sucesso!"),j(null),V()}catch(e){console.error("Erro ao atualizar usu\xe1rio:",e),alert("❌ Erro ao atualizar usu\xe1rio: ".concat(e.message||"Erro desconhecido"))}finally{h(!1)}},L=async()=>{if(!P||!O||P===O)return void alert("Por favor, selecione dois usu\xe1rios diferentes");if(confirm("⚠️ Tem certeza que deseja transferir todos os neg\xf3cios do usu\xe1rio origem para o usu\xe1rio destino?\n\nEsta a\xe7\xe3o n\xe3o pode ser desfeita!")){R(!0);try{if(!t)throw Error("Empresa n\xe3o encontrada");let e=await (0,i._k)(P,O,t);alert("✅ Transfer\xeancia conclu\xedda! ".concat(e.negociosTransferidos," neg\xf3cio(s) transferido(s).")),b(!1),z(""),q("")}catch(e){console.error("Erro ao transferir neg\xf3cios:",e),alert("❌ Erro ao transferir neg\xf3cios: ".concat(e.message||"Erro desconhecido"))}finally{R(!1)}}};return s?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-slate-900"})}):"admin"!==r?null:(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-4 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(l(),{href:"/",className:"text-gray-400 hover:text-gray-600",children:"← Voltar"}),(0,a.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Gerenciamento de Usu\xe1rios"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors",children:"Transferir Neg\xf3cios"}),(0,a.jsx)("button",{onClick:()=>p(!0),className:"px-4 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 transition-colors",children:"+ Novo Usu\xe1rio"})]})]})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-6 py-8",children:!x||g||f||y?(0,a.jsx)("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:0===u.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:4,className:"px-6 py-12 text-center text-sm text-gray-400",children:"Nenhum usu\xe1rio encontrado"})}):u.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50 transition-colors",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:(null==y?void 0:y.uid)===e.uid?(0,a.jsx)("input",{type:"text",value:T,onChange:e=>U(e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-md"}):e.nome||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.email||"-"}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(null==y?void 0:y.uid)===e.uid?(0,a.jsxs)("select",{value:_,onChange:e=>F(e.target.value),className:"px-2 py-1 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"func",children:"Funcion\xe1rio"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]}):(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("admin"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:"admin"===e.role?"Admin":"Funcion\xe1rio"})}),(0,a.jsx)("td",{className:"px-4 py-3 text-sm",children:(null==y?void 0:y.uid)===e.uid?(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:G,disabled:x,className:"text-green-600 hover:text-green-800 font-medium disabled:opacity-50",children:"Salvar"}),(0,a.jsx)("span",{className:"text-gray-300",children:"|"}),(0,a.jsx)("button",{onClick:()=>j(null),className:"text-gray-600 hover:text-gray-800 font-medium",children:"Cancelar"})]}):(0,a.jsx)("button",{onClick:()=>{j(e),U(e.nome),F(e.role)},className:"text-blue-600 hover:text-blue-800 font-medium",children:"Editar"})})]},e.uid))})]})})}):(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-8 text-center",children:[(0,a.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-slate-900"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Carregando usu\xe1rios..."})]})}),g&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Criar Novo Usu\xe1rio"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome"}),(0,a.jsx)("input",{type:"text",value:k,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900",placeholder:"Nome do usu\xe1rio"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",value:v,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900",placeholder:"email@exemplo.com"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Senha"}),(0,a.jsx)("input",{type:"password",value:w,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900",placeholder:"Senha tempor\xe1ria"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Role"}),(0,a.jsxs)("select",{value:S,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900",children:[(0,a.jsx)("option",{value:"func",children:"Funcion\xe1rio"}),(0,a.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:I,disabled:x,className:"flex-1 px-4 py-2 bg-slate-900 text-white rounded-md hover:bg-slate-800 transition-colors disabled:opacity-50",children:x?"Criando...":"Criar"}),(0,a.jsx)("button",{onClick:()=>{p(!1),N(""),C(""),E(""),A("func")},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"Cancelar"})]})]})}),f&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Transferir Neg\xf3cios"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Selecione o usu\xe1rio de origem (que perder\xe1 os neg\xf3cios) e o usu\xe1rio de destino (que receber\xe1 os neg\xf3cios)."}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usu\xe1rio Origem"}),(0,a.jsxs)("select",{value:P,onChange:e=>z(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900",children:[(0,a.jsx)("option",{value:"",children:"Selecione o usu\xe1rio origem"}),u.map(e=>(0,a.jsxs)("option",{value:e.uid,children:[e.nome," (",e.email,")"]},e.uid))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Usu\xe1rio Destino"}),(0,a.jsxs)("select",{value:O,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-slate-900",children:[(0,a.jsx)("option",{value:"",children:"Selecione o usu\xe1rio destino"}),u.filter(e=>e.uid!==P).map(e=>(0,a.jsxs)("option",{value:e.uid,children:[e.nome," (",e.email,")"]},e.uid))]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{onClick:L,disabled:D||!P||!O,className:"flex-1 px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:D?"Transferindo...":"Transferir"}),(0,a.jsx)("button",{onClick:()=>{b(!1),z(""),q("")},className:"flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:"Cancelar"})]})]})})]})}},2311:(e,s,r)=>{Promise.resolve().then(r.bind(r,2206))}},e=>{e.O(0,[595,965,773,158,742,441,255,358],()=>e(e.s=2311)),_N_E=e.O()}]);