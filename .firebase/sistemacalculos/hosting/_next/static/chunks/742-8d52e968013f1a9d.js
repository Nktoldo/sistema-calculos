"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[742],{3714:(o,e,a)=>{a.d(e,{A:()=>p,AuthProvider:()=>m});var r=a(5155),s=a(2115),t=a(2553),i=a(2078),c=a(708);let l=(0,i.Wp)({apiKey:"AIzaSyC3S-aQgsMEDE2hSrUJ1iO_SbviktcFdaU",authDomain:"sistemacalculos.firebaseapp.com",databaseURL:"https://sistemacalculos-default-rtdb.firebaseio.com",projectId:"sistemacalculos",storageBucket:"sistemacalculos.firebasestorage.app",messagingSenderId:"66550952911",appId:"1:66550952911:web:c25e9d5046567935b718ba",measurementId:"G-5VMWSY2ZQM"}),n=(0,t.xI)(l),u=(0,c.C3)(l),d=(0,s.createContext)(void 0);function m(o){let{children:e}=o,[a,i]=(0,s.useState)(null),[l,m]=(0,s.useState)(!0),[p,f]=(0,s.useState)(null),[b,g]=(0,s.useState)(null);async function v(o){try{let e=(await (0,c.Jt)((0,c.KR)(u,"usuarios/logins/".concat(o,"/empresa")))).val();return console.log(e),e}catch(o){return console.error("Erro ao buscar empresa do usu\xe1rio:",o),null}}async function P(o){try{let e=(await (0,c.Jt)((0,c.KR)(u,"usuarios/logins/".concat(o,"/role")))).val();if("admin"===e||"funcionario"===e)return e;return console.warn("Role inv\xe1lido para o usu\xe1rio ".concat(o,": ").concat(e)),"funcionario"}catch(o){return console.error("Erro ao buscar role do usu\xe1rio:",o),"funcionario"}}(0,s.useEffect)(()=>{let o=(0,t.hg)(n,async o=>{if(i(o),o){let e=await P(o.uid);f(e);let a=await v(o.uid);g(a),console.log("Usu\xe1rio autenticado: ".concat(o.email,", Role: ").concat(e,", Empresa: ").concat(a))}else f(null);m(!1)});return()=>o()},[]);let R=async(o,e)=>{await (0,t.x9)(n,o,e)},h=async()=>{await (0,t.CI)(n)};return(0,r.jsx)(d.Provider,{value:{user:a,loading:l,userRole:p,login:R,logout:h,empresa:b},children:e})}function p(){let o=(0,s.useContext)(d);if(void 0===o)throw Error("useAuth must be used within an AuthProvider");return o}},5029:(o,e,a)=>{a.d(e,{J6:()=>m,Jy:()=>f,_k:()=>h,g5:()=>R,getAllUsuarios:()=>v,i6:()=>g,j6:()=>P,n7:()=>b,nE:()=>d,wi:()=>p});var r=a(2078),s=a(708),t=a(2553),i=a(6849);let c=(0,r.Wp)({apiKey:"AIzaSyC3S-aQgsMEDE2hSrUJ1iO_SbviktcFdaU",authDomain:"sistemacalculos.firebaseapp.com",databaseURL:"https://sistemacalculos-default-rtdb.firebaseio.com",projectId:"sistemacalculos",storageBucket:"sistemacalculos.firebasestorage.app",messagingSenderId:"66550952911",appId:"1:66550952911:web:c25e9d5046567935b718ba",measurementId:"G-5VMWSY2ZQM"}),l=(0,s.C3)(c),n=(0,t.xI)(c),u=(0,i.Uz)(c,"us-central1");async function d(o){try{let e=await (0,s.Jt)((0,s.KR)(l,"usuarios/logins"));if(!e.exists())return console.warn("Nenhum usu\xe1rio encontrado em usuarios/logins"),[];let a=e.val()||{},r=[];return Object.entries(a).forEach(e=>{let[a,s]=e;if(s&&"func"===s.role&&s.empresa===o){let o=s.nome||s.email||a;r.push({uid:a,nome:o})}}),r}catch(o){return console.error("Erro ao buscar funcion\xe1rios:",o),[]}}async function m(o,e,a){let r=(0,s.VC)((0,s.KR)(l,"".concat(a,"/calculos/geral"))).key,t={};return t["".concat(a,"/calculos/geral/").concat(r)]={data:o.data,cidade:o.cidade,estado:o.estado,cliente:o.cliente,produto:o.produto,quantidade:o.quantidade,marca:o.marca,modelo:o.modelo,origem:o.origem,tipo:o.tipo,custoProduto:o.custoProduto,frete:o.frete,tipoFrete:o.tipoFrete,precoVenda:o.precoVenda,difalReais:o.difalReais,comissaoReais:o.comissaoReais,impostosReais:o.impostosReais,comissaoPerc:o.comissaoPerc,impostosPerc:o.impostosPerc,difalPerc:o.difalPerc,boleto:o.boleto,observacoes:o.observacoes||"",id:o.id,responsavel:o.responsavel,criadoPor:o.criadoPor,emailResponsavel:o.emailResponsavel,status:o.status,statusFirebase:o.statusFirebase,responsavelOriginal:o.responsavelOriginal||null},"admin"==e&&(t["".concat(a,"/calculos/lucro/").concat(r)]={lucroDesejado:o.lucroDesejado,lucroLiquido:o.lucroLiquido,lucroAbsoluto:o.lucroAbsoluto,markup:o.markup,lucro20:o.lucro20,lucro30:o.lucro30}),await (0,s.yo)((0,s.KR)(l),t),r}async function p(o,e,a){let r={};r["".concat(a,"/calculos/geral/").concat(o.idFirebase)]={data:o.data,cidade:o.cidade,estado:o.estado,cliente:o.cliente,produto:o.produto,quantidade:o.quantidade,marca:o.marca,modelo:o.modelo,origem:o.origem,tipo:o.tipo,custoProduto:o.custoProduto,frete:o.frete,tipoFrete:o.tipoFrete,precoVenda:o.precoVenda,difalReais:o.difalReais,comissaoReais:o.comissaoReais,impostosReais:o.impostosReais,comissaoPerc:o.comissaoPerc,impostosPerc:o.impostosPerc,difalPerc:o.difalPerc,boleto:o.boleto,observacoes:o.observacoes||"",id:o.id,status:o.status,statusFirebase:o.statusFirebase,atualizadoEm:o.atualizadoEm||new Date().toISOString()},o.responsavel&&(r["".concat(a,"/calculos/geral/").concat(o.idFirebase)].responsavel=o.responsavel),o.criadoPor&&(r["".concat(a,"/calculos/geral/").concat(o.idFirebase)].criadoPor=o.criadoPor),void 0!==o.responsavelOriginal&&(r["".concat(a,"/calculos/geral/").concat(o.idFirebase)].responsavelOriginal=o.responsavelOriginal),"admin"==e&&(r["".concat(a,"/calculos/lucro/").concat(o.idFirebase)]={lucroDesejado:o.lucroDesejado,lucroLiquido:o.lucroLiquido,lucroAbsoluto:o.lucroAbsoluto,markup:o.markup,lucro20:o.lucro20,lucro30:o.lucro30}),await (0,s.yo)((0,s.KR)(l),r)}async function f(o,e,a){try{let[r,t]=await Promise.all([(0,s.Jt)((0,s.KR)(l,"".concat(a,"/calculos/geral/").concat(o))),"admin"==e?(0,s.Jt)((0,s.KR)(l,"".concat(a,"/calculos/lucro/").concat(o))):Promise.resolve(null)]),i=r.val(),c="admin"==e?t.val():null;if(!i)return null;let n={idFirebase:o,id:i.id,status:i.status,statusFirebase:i.statusFirebase,responsavel:i.responsavel,criadoPor:i.criadoPor||null,data:i.data,cidade:i.cidade,estado:i.estado,cliente:i.cliente,marca:i.marca,produto:i.produto,tipo:i.tipo,quantidade:i.quantidade,modelo:i.modelo,origem:i.origem,custoProduto:i.custoProduto,frete:i.frete,tipoFrete:i.tipoFrete,precoVenda:i.precoVenda,difalReais:i.difalReais,comissaoReais:i.comissaoReais,impostosReais:i.impostosReais,comissaoPerc:i.comissaoPerc,impostosPerc:i.impostosPerc,difalPerc:i.difalPerc,boleto:i.boleto,emailResponsavel:i.emailResponsavel,responsavel:i.responsavel,responsavelOriginal:i.responsavelOriginal||null,observacoes:i.observacoes||""};if(c)return{...n,lucroDesejado:c.lucroDesejado,lucroLiquido:c.lucroLiquido,lucroAbsoluto:c.lucroAbsoluto,markup:c.markup,lucro20:c.lucro20,lucro30:c.lucro30};return n}catch(o){return console.error("Erro ao buscar formul\xe1rio:",o),null}}async function b(o,e,a){try{if("admin"===o){let[o,e]=await Promise.all([(0,s.Jt)((0,s.KR)(l,"".concat(a,"/calculos/geral"))),(0,s.Jt)((0,s.KR)(l,"".concat(a,"/calculos/lucro")))]),r=o.val()||{},t=e.val()||{},i=[];return Object.entries(r).forEach(o=>{let[e,a]=o,r={idFirebase:e,id:a.id,status:a.status,statusFirebase:a.statusFirebase,responsavel:a.responsavel,criadoPor:a.criadoPor||null,data:a.data,cidade:a.cidade,estado:a.estado,cliente:a.cliente,marca:a.marca,produto:a.produto,tipo:a.tipo,quantidade:a.quantidade,modelo:a.modelo,origem:a.origem,custoProduto:a.custoProduto,frete:a.frete,tipoFrete:a.tipoFrete,precoVenda:a.precoVenda,difalReais:a.difalReais,comissaoReais:a.comissaoReais,impostosReais:a.impostosReais,comissaoPerc:a.comissaoPerc,impostosPerc:a.impostosPerc,difalPerc:a.difalPerc,boleto:a.boleto,emailResponsavel:a.emailResponsavel,responsavelOriginal:a.responsavelOriginal||null,observacoes:a.observacoes||""};t[e]&&(r={...r,lucroDesejado:t[e].lucroDesejado,lucroLiquido:t[e].lucroLiquido,lucroAbsoluto:t[e].lucroAbsoluto,markup:t[e].markup,lucro20:t[e].lucro20,lucro30:t[e].lucro30}),i.push(r)}),i}let r=(0,s.P)((0,s.KR)(l,"".concat(a,"/calculos/geral")),(0,s.kT)("responsavel"),(0,s.iz)(e)),t=(await (0,s.Jt)(r)).val()||{},i=[];return Object.entries(t).forEach(o=>{let[e,a]=o;i.push({idFirebase:e,id:a.id,status:a.status,statusFirebase:a.statusFirebase,responsavel:a.responsavel,criadoPor:a.criadoPor||null,data:a.data,cidade:a.cidade,cliente:a.cliente,marca:a.marca,produto:a.produto,tipo:a.tipo,quantidade:a.quantidade,modelo:a.modelo,origem:a.origem,custoProduto:a.custoProduto,frete:a.frete,precoVenda:a.precoVenda,difalReais:a.difalReais,comissaoReais:a.comissaoReais,impostosReais:a.impostosReais,comissaoPerc:a.comissaoPerc,impostosPerc:a.impostosPerc,difalPerc:a.difalPerc,boleto:a.boleto,emailResponsavel:a.emailResponsavel,responsavelOriginal:a.responsavelOriginal||null,observacoes:a.observacoes||""})}),i}catch(o){return console.error("Erro ao buscar formul\xe1rios:",o),[]}}async function g(o,e){try{let a={};return a["".concat(e,"/calculos/geral/").concat(o)]=null,a["".concat(e,"/calculos/lucro/").concat(o)]=null,await (0,s.yo)((0,s.KR)(l),a),!0}catch(o){throw console.error("Erro ao excluir c\xe1lculo:",o),o}}async function v(o){try{let e=await (0,s.Jt)((0,s.KR)(l,"usuarios/logins"));if(!e.exists())return[];let a=e.val()||{},r=[];return Object.entries(a).forEach(e=>{let[a,s]=e;s&&s.empresa===o&&r.push({uid:a,nome:s.nome||"",role:s.role||"func",empresa:s.empresa||o,email:s.email||""})}),r}catch(o){return console.error("Erro ao buscar usu\xe1rios:",o),[]}}async function P(o,e,a,r,s){try{let t=n.currentUser;if(!t)throw Error("Usu\xe1rio n\xe3o autenticado. Fa\xe7a login para continuar.");console.log("Usu\xe1rio autenticado:",t.uid);let c=(0,i.Qg)(u,"createEmployee"),l=(await c({email:o,password:e,nome:a,role:r,empresa:s})).data;if(l.success)return{success:!0,uid:l.uid,email:l.email,nome:l.nome,role:l.role,empresa:l.empresa};throw Error("Falha ao criar usu\xe1rio")}catch(o){if(console.error("Erro ao criar usu\xe1rio:",o),console.error("Detalhes do erro:",{code:o.code,message:o.message,details:o.details}),"functions/permission-denied"===o.code)throw Error("Acesso negado. Apenas administradores podem criar usu\xe1rios.");if("functions/unauthenticated"===o.code)throw Error("Usu\xe1rio n\xe3o autenticado. Fa\xe7a login para continuar.");if("functions/invalid-argument"===o.code)throw Error(o.message||"Dados inv\xe1lidos fornecidos.");else if("functions/already-exists"===o.code)throw Error("Este email j\xe1 est\xe1 cadastrado.");else if("functions/internal"===o.code)throw Error(o.message||o.details||"Erro interno ao criar usu\xe1rio.");else if("functions/not-found"===o.code)throw Error("Fun\xe7\xe3o n\xe3o encontrada. Verifique se as Cloud Functions foram deployadas.");if(o.message)throw Error(o.message);throw Error("Erro desconhecido ao criar usu\xe1rio. Verifique o console para mais detalhes.")}}async function R(o,e,a){try{let r={};return r["usuarios/logins/".concat(o,"/nome")]=e,r["usuarios/logins/".concat(o,"/role")]="admin"===a?"admin":"func",await (0,s.yo)((0,s.KR)(l),r),{success:!0}}catch(o){throw console.error("Erro ao atualizar usu\xe1rio:",o),o}}async function h(o,e,a){try{let r=(await (0,s.Jt)((0,s.KR)(l,"".concat(a,"/calculos/geral")))).val()||{},t={},i=0;return Object.entries(r).forEach(r=>{let[s,c]=r;c.responsavel===o&&(t["".concat(a,"/calculos/geral/").concat(s,"/responsavel")]=e,c.responsavelOriginal||(t["".concat(a,"/calculos/geral/").concat(s,"/responsavelOriginal")]=o),i++)}),i>0&&await (0,s.yo)((0,s.KR)(l),t),{success:!0,negociosTransferidos:i}}catch(o){throw console.error("Erro ao transferir neg\xf3cios:",o),o}}}}]);